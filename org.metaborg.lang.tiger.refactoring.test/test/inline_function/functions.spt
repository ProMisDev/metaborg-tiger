module inline-functions

language TigerRefactoring


test inline procedure call [[
let 
	function printnl(x : string) = (
		print(x); 
		print("\n")
	)
in
   	printnl("Hello World");
   	printnl("Hello World")
end
]] run inline-procedure-test to [[
let
  
 in
  let
    var x : string := "Hello World"
   in
    (
      print(x);
      print("\n")
    )
  end;
  let
    var x : string := "Hello World"
   in
    (
      print(x);
      print("\n")
    )
  end
end
]]

test inline function call [[
let 
	function plus(a : int, b:int) : int = (
		a + b
	)
in 
   	plus(1,2);
   	plus(3,4)
end
]] run inline-function-test to [[
let
 in
  let
    var a : int := 1
    var b : int := 2
   in
    (
      a + b
    )
  end;
  let
    var a : int := 3
    var b : int := 4
   in
    (
      a + b
    )
  end
end
]]

test inline recursive function call [[
let 
  function fact(n : int) : int = 
    let
      var c := n < 1
     in if c then 
          1 
        else
          let 
            var a : int := n - 1
            var b : int := fact(a)            
            var c : int := n * b 
           in c
          end
    end  
    var r := fact(10)
 in r
end
]] run inline-function-recursion-test